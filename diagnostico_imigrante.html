<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Assistente Migrat√≥rio Humanit√°rio ‚Äì Evoluzion</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .flag { width: 24px; height: 16px; margin-right: 8px; vertical-align: middle; }
        button {
            padding: 12px 18px;
            background-color: #e5e7eb; /* Cor padr√£o dos bot√µes */
            border-radius: 8px;
            font-weight: 500;
            text-align: center;
            cursor: pointer;
            transition: background-color 0.2s, color 0.2s;
        }
        button:hover {
            background-color: #d1d5db;
        }
        button.selected {
            background-color: #fde047; /* Amarelo */
            color: #1f2937; /* Texto escuro para contraste */
            font-weight: bold;
        }
        #resultado {
            white-space: pre-wrap; /* Permite quebras de linha e espa√ßos no texto */
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-900">

    <header class="bg-gray-800 text-white py-6 text-center shadow-md">
        <h1 class="text-3xl font-bold">üåç Assistente Migrat√≥rio Humanit√°rio</h1>
        <p class="mt-2 text-sm">Vamos te ajudar com AMIZADE, clareza e caminhos poss√≠veis!</p>
    </header>

    <main class="max-w-4xl mx-auto px-4 py-8 space-y-10">

        <section>
            <h2 class="text-xl font-semibold mb-4">1Ô∏è‚É£ Seu pa√≠s de origem?</h2>
            <select id="paisOrigem" class="w-full p-3 border rounded">
                <option value="">‚Äì Escolha ‚Äì</option>
                <option value="Brasil">üáßüá∑ Brasil</option>
                <option value="China">üá®üá≥ China</option>
                <option value="India">üáÆüá≥ √çndia</option>
                <option value="Russia">üá∑üá∫ R√∫ssia</option>
                <option value="AfricaDoSul">üáøüá¶ √Åfrica do Sul</option>
                <option value="Marrocos">üá≤üá¶ Marrocos</option>
            </select>
        </section>

        <section>
            <h2 class="text-xl font-semibold mb-4">2Ô∏è‚É£ Para qual pa√≠s vai ou j√° est√°?</h2>
            <select id="paisDestino" class="w-full p-3 border rounded">
                <option value="">‚Äì Escolha ‚Äì</option>
                <option value="Brasil">üáßüá∑ Brasil</option>
                <option value="Schengen">üá™üá∫ Uni√£o Europeia (Schengen)</option>
                <option value="Russia">üá∑üá∫ R√∫ssia</option>
                <option value="Marrocos">üá≤üá¶ Marrocos</option>
                <option value="EUA">üá∫üá∏ Estados Unidos</option>
                <option value="Canada">üá®üá¶ Canad√°</option>
            </select>
        </section>

        <section>
            <h2 class="text-xl font-semibold mb-4">3Ô∏è‚É£ O que busca?</h2>
            <div id="opcoes" class="grid grid-cols-2 sm:grid-cols-3 gap-4">
                <button data-type="Visita">Visto de Visita</button>
                <button data-type="Trabalho">Visto de Trabalho</button>
                <button data-type="Temp">Resid√™ncia Tempor√°ria</button>
                <button data-type="Perm">Resid√™ncia Permanente</button>
                <button data-type="Refugio">Ref√∫gio</button>
                <button data-type="Anistia">Anistia</button>
            </div>
        </section>

        <section id="resultadoContainer" class="hidden bg-yellow-50 p-6 rounded shadow-lg border-l-4 border-yellow-500">
            <h2 class="text-2xl font-bold text-yellow-800 mb-4">üìã Seu Roteiro Migrat√≥rio Humanit√°rio</h2>
            <p id="textoResultado" class="text-gray-800 text-base leading-relaxed"></p>
            <div class="mt-8 text-center">
                <a href="https://wa.me/5544984342756" target="_blank"
                   class="inline-flex items-center bg-green-600 hover:bg-green-700 text-white px-8 py-4 rounded-full font-semibold transition shadow-lg transform hover:scale-105">
                    <svg class="w-6 h-6 mr-2" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z"></path><path fill-rule="evenodd" d="M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z" clip-rule="evenodd"></path></svg>
                    Fale com nosso especialista!
                </a>
            </div>
        </section>

        <section class="mt-10 bg-blue-50 p-6 rounded shadow-lg border-l-4 border-blue-500">
            <h2 class="text-2xl font-bold text-blue-800 mb-4">üí¨ Converse com nosso Assistente de IA!</h2>
            <div id="chatMessages" class="bg-white p-4 rounded-lg h-64 overflow-y-auto mb-4 border border-gray-200 flex flex-col space-y-2">
                <p class="text-gray-600 mb-2">Ol√°! Eu sou seu assistente migrat√≥rio. Pergunte-me algo sobre seu processo. Voc√™ tamb√©m pode preencher os campos acima para me dar mais contexto.</p>
            </div>
            <div class="flex">
                <input type="text" id="chatInput" placeholder="Digite sua pergunta aqui..." class="flex-grow p-3 border rounded-l-lg focus:outline-none focus:ring-2 focus:ring-blue-500" />
                <button id="chatSendBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-r-lg font-semibold transition">Enviar</button>
            </div>
            <p id="chatError" class="text-red-500 text-sm mt-2 hidden">Ocorreu um erro. Por favor, tente novamente.</p>
            <p id="chatLoading" class="text-blue-500 text-sm mt-2 hidden">Digitando...</p>
        </section>
        </main>

    <footer class="bg-gray-900 text-white text-center text-sm py-4 mt-10">
        Assistente humanit√°rio ‚Äì Evol.U.Zion üåé
    </footer>

    <script>
        let tipoEscolhido = '';
        const paisOrigemSelect = document.getElementById('paisOrigem');
        const paisDestinoSelect = document.getElementById('paisDestino');
        const opcoesDiv = document.getElementById('opcoes');
        const resultadoContainer = document.getElementById('resultadoContainer');
        const textoResultado = document.getElementById('textoResultado');

        // Novas refer√™ncias para o chatbot
        const chatInput = document.getElementById('chatInput');
        const chatSendBtn = document.getElementById('chatSendBtn');
        const chatMessages = document.getElementById('chatMessages');
        const chatError = document.getElementById('chatError');
        const chatLoading = document.getElementById('chatLoading');

        // --- IMPORTANTE: SUBSTITUA ESTE URL PELO SEU ENDPOINT REAL DO VERCEL FUNCTIONS ---
        // Certifique-se de que termina com /api/chat
        const GEMINI_BACKEND_URL = 'https://assistente-gemini-backend.vercel.app/api/chat'; 


        // --- Base de Conhecimento (Dados do MVP) ---
        // Mantenha seu objeto 'dadosPaises' e 'dadosVistos' aqui, como no c√≥digo anterior
        // Eu inclu√≠ eles aqui novamente para que o script seja completo, mas voc√™ j√° tinha isso.
        const dadosPaises = {
            Brasil: {
                moeda: 'Real (R$)',
                passaporte: {
                    valor: 'R$‚ÄØ257,25',
                    link: 'https://www.gov.br/pt-br/servicos/obter-passaporte-comum-para-brasileiro',
                    requisitos: 'Documento de identidade, CPF, t√≠tulo de eleitor, comprovante de quita√ß√£o militar (homens).'
                },
                servicosComuns: {
                    traducaoJuramentada: 'R$ 150 - R$ 300 por p√°gina (aprox.)',
                    apostilamento: 'R$ 50 - R$ 150 por documento (aprox.)'
                }
            },
            China: {
                moeda: 'Yuan (CNY)',
                passaporte: {
                    valor: 'CNY‚ÄØ120 (~US$18)',
                    link: 'https://www.fmprc.gov.cn/eng/', // Exemplo de link oficial
                    requisitos: 'Identidade chinesa, fotos.'
                },
                servicosComuns: {
                    traducaoJuramentada: 'CNY 200 - 500 por p√°gina',
                    apostilamento: 'CNY 100 - 300 por documento'
                }
            },
            India: {
                moeda: 'R√∫pia Indiana (‚Çπ)',
                passaporte: {
                    valor: '‚Çπ‚ÄØ1‚ÄØ500 (normal) / ‚Çπ‚ÄØ3‚ÄØ500 (urg√™ncia)',
                    link: 'https://passportindia.gov.in/', // Exemplo de link oficial
                    requisitos: 'Comprovante de endere√ßo, prova de cidadania.'
                },
                servicosComuns: {
                    traducaoJuramentada: '‚Çπ 1000 - 2500 por p√°gina',
                    apostilamento: '‚Çπ 500 - 1500 por documento'
                }
            },
            Russia: {
                moeda: 'Rublo (RUB)',
                passaporte: {
                    valor: 'RUB‚ÄØ2000 (~US$25)',
                    link: 'https://www.kdmid.ru/',
                    requisitos: 'Documentos de identifica√ß√£o, fotos.'
                },
                servicosComuns: {
                    traducaoJuramentada: 'RUB 1500 - 4000 por p√°gina',
                    apostilamento: 'RUB 800 - 2500 por documento'
                }
            },
            AfricaDoSul: {
                moeda: 'Rand (ZAR)',
                passaporte: {
                    valor: 'US$‚ÄØ67 (comum)', // Valor em USD para facilitar compara√ß√£o
                    link: 'https://www.gov.za/services/travel-and-tourism/passports-and-travel-documents', // Exemplo de link oficial
                    requisitos: 'Identidade nacional, comprovante de resid√™ncia.'
                },
                servicosComuns: {
                    traducaoJuramentada: 'ZAR 300 - 700 por p√°gina',
                    apostilamento: 'ZAR 150 - 400 por documento'
                }
            },
            Marrocos: {
                moeda: 'Dirham Marroquino (MAD)',
                passaporte: {
                    valor: 'MAD 300 (~US$30)',
                    link: 'https://www.maec.gov.ma/fr', // Exemplo de link oficial
                    requisitos: 'Cart√£o de identifica√ß√£o nacional, fotos.'
                },
                servicosComuns: {
                    traducaoJuramentada: 'MAD 200 - 500 por p√°gina',
                    apostilamento: 'MAD 100 - 250 por documento'
                }
            },
            Schengen: { // Uni√£o Europeia (Schengen) - dados gerais
                moeda: 'Euro (‚Ç¨)',
                passaporte: { valor: 'Consultar consulado do pa√≠s de destino na UE' },
                servicosComuns: {
                    traducaoJuramentada: '‚Ç¨ 30 - ‚Ç¨ 80 por p√°gina (varia por pa√≠s/idioma)',
                    apostilamento: '‚Ç¨ 20 - ‚Ç¨ 50 por documento (varia por pa√≠s)'
                }
            },
            EUA: {
                moeda: 'D√≥lar (US$)',
                passaporte: { valor: 'Consultar consulado do pa√≠s de destino' },
                servicosComuns: {
                    traducaoJuramentada: 'US$ 20 - US$ 50 por p√°gina',
                    apostilamento: 'US$ 10 - US$ 20 por documento'
                }
            },
            Canada: {
                moeda: 'D√≥lar Canadense (CAD)',
                passaporte: { valor: 'Consultar consulado do pa√≠s de destino' },
                servicosComuns: {
                    traducaoJuramentada: 'CAD 25 - CAD 75 por p√°gina',
                    apostilamento: 'CAD 10 - CAD 30 por documento'
                }
            }
        };

        const dadosVistos = {
            Marrocos: {
                Visita: {
                    info: 'Visto dispensado para a maioria das nacionalidades para estadias de at√© 90 dias. √â necess√°rio passaporte v√°lido por no m√≠nimo 6 meses.',
                    orgao: 'Entrada pelo controle de fronteiras marroquino',
                    custoTaxa: 'N/A',
                    documentos: 'Passaporte, passagem de retorno, comprova√ß√£o de meios financeiros.',
                    link: 'https://www.diplomatie.ma/'
                },
                Trabalho: { // Exemplo mais detalhado
                    info: 'Exige oferta de trabalho de empregador marroquino e autoriza√ß√£o de trabalho emitida pelas autoridades marroquinas. Processo complexo.',
                    orgao: 'Minist√©rio do Emprego e Assuntos Sociais de Marrocos; Consulado/Embaixada de Marrocos em seu pa√≠s de origem.',
                    custoTaxa: 'MAD 500 - MAD 1000 (taxas governamentais, pode variar)',
                    documentos: 'Contrato de trabalho, diploma(s), certid√µes, antecedentes criminais, passaporte.',
                    link: 'https://www.diplomatie.ma/'
                }
            },
            Schengen: {
                Visita: {
                    info: 'Visto Schengen para turismo. Permite estadia de at√© 90 dias em um per√≠odo de 180 dias. Solicitar no consulado do pa√≠s de entrada ou de maior perman√™ncia.',
                    orgao: 'Consulado/Embaixada do pa√≠s membro Schengen de destino em seu pa√≠s de origem.',
                    custoTaxa: '‚Ç¨ 90 (adultos) / ‚Ç¨ 45 (crian√ßas 6-12 anos)',
                    documentos: 'Passaporte v√°lido, formul√°rio de visto, foto, seguro viagem (m√≠n. ‚Ç¨ 30.000 cobertura), comprova√ß√£o de meios financeiros, reserva de hotel/carta convite, passagem a√©rea.',
                    link: 'https://brasil.diplo.de/br-pt/servicos/vistos/schengen/schengen-2610370'
                },
                Trabalho: {
                    info: 'Cada pa√≠s da Uni√£o Europeia tem regras espec√≠ficas para vistos de trabalho. Geralmente exige oferta de emprego e autoriza√ß√£o.',
                    orgao: 'Consulado/Embaixada do pa√≠s espec√≠fico da UE.',
                    custoTaxa: 'Varia por pa√≠s (‚Ç¨ 70 - ‚Ç¨ 150 ou mais)',
                    documentos: 'Contrato de trabalho, qualifica√ß√µes, antecedentes criminais, seguro sa√∫de.',
                    link: 'https://ec.europa.eu/home-affairs/policies/migration-and-asylum/legal-migration-and-integration/work-visas_en'
                }
            },
            EUA: {
                Visita: {
                    info: 'Visto de N√£o-Imigrante B1/B2 (Neg√≥cios/Turismo). Necess√°rio entrevista consular.',
                    orgao: 'Embaixada/Consulados dos EUA em seu pa√≠s de origem.',
                    custoTaxa: 'US$ 185 (taxa MRV)',
                    documentos: 'Passaporte v√°lido (m√≠n. 6 meses ap√≥s a data pretendida de estadia), formul√°rio DS-160, comprovante de meios financeiros, v√≠nculos com pa√≠s de origem.',
                    link: 'https://ceac.state.gov/genniv/'
                },
                Trabalho: {
                    info: 'Diversos tipos de visto de trabalho (H1B, L1, O1 etc.), cada um com requisitos espec√≠ficos e complexos, geralmente exigindo peti√ß√£o aprovada pelo empregador nos EUA.',
                    orgao: 'USCIS (Servi√ßos de Cidadania e Imigra√ß√£o dos EUA) e Embaixada/Consulados dos EUA.',
                    custoTaxa: 'US$ 185 (taxa MRV do visto) + taxas de peti√ß√£o (US$ 460 - US$ 4.000+ dependendo do visto)',
                    documentos: 'Peti√ß√£o aprovada, qualifica√ß√£o profissional, antecedentes criminais.',
                    link: 'https://www.uscis.gov/working-in-the-united-states'
                }
            },
            Canada: {
                Visita: {
                    info: 'Visto de Visitante (Temporary Resident Visa - TRV) ou eTA (Autoriza√ß√£o Eletr√¥nica de Viagem) para cidad√£os eleg√≠veis. Pedido online.',
                    orgao: 'Immigration, Refugees and Citizenship Canada (IRCC) - online.',
                    custoTaxa: 'CAD 100 por pessoa (TRV) / CAD 7 (eTA)',
                    documentos: 'Passaporte v√°lido, formul√°rio online, comprovante de meios financeiros, passagem de retorno, carta convite (se aplic√°vel).',
                    link: 'https://www.canada.ca/en/immigration-refugees-citizenship/services/visit-canada.html'
                },
                Refugio: {
                    info: 'Processo de solicita√ß√£o de Ref√∫gio. Exige que a pessoa tenha uma base para o pedido de prote√ß√£o.',
                    orgao: 'Immigration, Refugees and Citizenship Canada (IRCC) e Conselho de Imigra√ß√£o e Ref√∫gio do Canad√° (IRB).',
                    custoTaxa: 'Geralmente n√£o h√° taxa para o pedido de ref√∫gio em si, mas pode haver custos com documentos e servi√ßos jur√≠dicos.',
                    documentos: 'Formul√°rio de solicita√ß√£o, documentos de identifica√ß√£o, provas que justifiquem o medo de persegui√ß√£o no pa√≠s de origem.',
                    link: 'https://www.canada.ca/en/immigration-refugees-citizenship/services/refugees/claim-canada.html'
                }
            },
            Brasil: {
                Refugio: {
                    info: 'Processo de solicita√ß√£o de ref√∫gio no Brasil. Conforme a Lei n¬∫ 9.474/1997.',
                    orgao: 'Pol√≠cia Federal (PF) - Unidade de Protocolo; Comit√™ Nacional para os Refugiados (CONARE) ‚Äì Minist√©rio da Justi√ßa.',
                    custoTaxa: 'N√£o h√° taxa para o pedido de ref√∫gio.',
                    documentos: 'Documento de identifica√ß√£o (se possuir), formul√°rio de solicita√ß√£o preenchido, relatos e provas dos motivos do pedido de ref√∫gio.',
                    link: 'https://www.gov.br/mj/pt-br/assuntos/seus-direitos/refugio'
                },
                Perm: {
                    info: 'Resid√™ncia Permanente no Brasil (por reuni√£o familiar, investimento, aposentadoria etc.).',
                    orgao: 'Pol√≠cia Federal (PF); Minist√©rio da Justi√ßa e Seguran√ßa P√∫blica.',
                    custoTaxa: 'Taxas para emiss√£o de Carteira de Registro Nacional Migrat√≥rio (CRNM) e taxa de processamento de pedido.',
                    documentos: 'Passaporte, certid√µes, antecedentes criminais, comprovantes de meios de subsist√™ncia, formul√°rios espec√≠ficos.',
                    link: 'https://www.gov.br/pt-br/servicos/obter-autorizacao-de-residencia-para-imigrantes'
                }
            }
        };

        // --- Fun√ß√µes de L√≥gica ---

        function displayMessage(message, sender) {
            const messageElement = document.createElement('div'); // Mudado para div para melhor controle de layout
            messageElement.classList.add('p-3', 'rounded-lg', 'max-w-[80%]');
            if (sender === 'user') {
                messageElement.classList.add('bg-blue-100', 'self-end', 'ml-auto', 'text-right');
                messageElement.innerHTML = `<strong>Voc√™:</strong> ${message}`;
            } else if (sender === 'gemini') {
                messageElement.classList.add('bg-gray-100', 'mr-auto', 'text-left');
                messageElement.innerHTML = `<strong>Assistente:</strong> ${message}`;
            } else if (sender === 'error') {
                messageElement.classList.add('bg-red-100', 'text-red-800', 'mr-auto', 'text-left');
                messageElement.innerHTML = `<strong>Erro:</strong> ${message}`;
            }
            chatMessages.appendChild(messageElement);
            chatMessages.scrollTop = chatMessages.scrollHeight; // Scroll para o final
        }

        async function sendChatMessage() {
            const userMessage = chatInput.value.trim();
            if (!userMessage) return;

            displayMessage(userMessage, 'user');
            chatInput.value = '';
            chatInput.disabled = true;
            chatSendBtn.disabled = true;
            chatLoading.classList.remove('hidden');
            chatError.classList.add('hidden');

            const paisOrigem = paisOrigemSelect.value;
            const paisDestino = paisDestinoSelect.value;
            const tipoServico = tipoEscolhido; // Pega o tipo de servi√ßo selecionado pelos bot√µes

            try {
                const response = await fetch(GEMINI_BACKEND_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: userMessage,
                        paisOrigem: paisOrigem,
                        paisDestino: paisDestino,
                        tipoServico: tipoServico
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || `Erro HTTP: ${response.status}`);
                }

                const data = await response.json();
                displayMessage(data.reply, 'gemini');

            } catch (error) {
                console.error('Erro ao comunicar com o chatbot:', error);
                chatError.textContent = `Ocorreu um erro: ${error.message}. Por favor, tente novamente.`;
                chatError.classList.remove('hidden');
                displayMessage('N√£o foi poss√≠vel obter uma resposta do assistente.', 'error');
            } finally {
                chatInput.disabled = false;
                chatSendBtn.disabled = false;
                chatLoading.classList.add('hidden');
                chatInput.focus();
            }
        }

        // Fun√ß√£o para selecionar o tipo de servi√ßo e atualizar a interface
        function selecionarTipo(event) {
            const clickedButton = event.target;
            // Remover 'selected' de todos os bot√µes
            document.querySelectorAll('#opcoes button').forEach(btn => {
                btn.classList.remove('selected');
            });
            // Adicionar 'selected' ao bot√£o clicado
            clickedButton.classList.add('selected');
            tipoEscolhido = clickedButton.dataset.type; // Pega o valor do atributo data-type
            montarResultado(); // Chama a fun√ß√£o para montar o resultado
        }

        // Fun√ß√£o principal para montar o resultado
        function montarResultado() {
            const paisOrigem = paisOrigemSelect.value;
            const paisDestino = paisDestinoSelect.value;

            // S√≥ gera o resultado se os 3 campos principais estiverem preenchidos
            if (!paisOrigem || !paisDestino || !tipoEscolhido) {
                resultadoContainer.classList.add('hidden'); // Esconde o resultado se incompleto
                return;
            }

            let msg = ``;
            let custoTotalEstimado = 0;

            msg += `‚ú® **Informa√ß√µes para voc√™:**\n\n`;
            msg += `üåé **Seu caminho:** De **${paisOrigem}** para **${paisDestino}**, buscando **${tipoEscolhido}**.\n\n`;

            // --- Dados do Pa√≠s de Origem (Passaporte) ---
            const infoOrigem = dadosPaises[paisOrigem];
            if (infoOrigem && infoOrigem.passaporte) {
                msg += `--- Passaporte em **${paisOrigem}** ---\n`;
                msg += `üìù **Custo estimado:** ${infoOrigem.passaporte.valor}\n`;
                msg += `‚úÖ **Requisitos comuns:** ${infoOrigem.passaporte.requisitos || 'Consultar √≥rg√£o oficial.'}\n`;
                msg += `üîó **Link oficial:** ${infoOrigem.passaporte.link || 'N/A'}\n\n`;
                // Tenta adicionar o custo do passaporte ao total, se for num√©rico
                const valorPassaporte = parseFloat(String(infoOrigem.passaporte.valor).replace(/[^\d,.]/g, '').replace(',', '.'));
                if (!isNaN(valorPassaporte)) {
                    custoTotalEstimado += valorPassaporte;
                }
            } else {
                msg += `--- Informa√ß√µes de passaporte para ${paisOrigem} n√£o dispon√≠veis ou n√£o aplic√°veis. ---\n\n`;
            }

            // --- Dados do Visto/Resid√™ncia no Pa√≠s de Destino ---
            const infoVisto = dadosVistos[paisDestino] && dadosVistos[paisDestino][tipoEscolhido];
            if (infoVisto) {
                msg += `--- Detalhes para **${tipoEscolhido}** em **${paisDestino}** ---\n`;
                msg += `üí° **Tipo de processo:** ${infoVisto.info}\n`;
                msg += `üèõÔ∏è **√ìrg√£o(s) respons√°vel(is):** ${infoVisto.orgao}\n`;
                msg += `üí∞ **Custo da taxa oficial:** ${infoVisto.custoTaxa}\n`;
                msg += `üìÑ **Documentos e requisitos principais:** ${infoVisto.documentos}\n`;
                msg += `üîó **Link oficial:** ${infoVisto.link || 'N/A'}\n\n`;
                // Tenta adicionar o custo da taxa oficial ao total
                const valorVisto = parseFloat(String(infoVisto.custoTaxa).replace(/[^\d,.]/g, '').replace(',', '.'));
                if (!isNaN(valorVisto)) {
                    custoTotalEstimado += valorVisto;
                }
            } else if (paisDestino === 'Marrocos' && tipoEscolhido === 'Visita') {
                msg += `--- Detalhes para **${tipoEscolhido}** em **${paisDestino}** ---\n`;
                msg += `üí° **Visto:** N√£o exigido para a maioria das nacionalidades para estadias de at√© 90 dias. Apenas passaporte v√°lido.\n`;
                msg += `üîó **Link oficial:** https://www.diplomatie.ma/\n\n`;
            } else {
                msg += `--- Informa√ß√µes para **${tipoEscolhido}** em **${paisDestino}** ---\n`;
                msg += `üí° **Informa√ß√£o:** Para este tipo de servi√ßo e pa√≠s, por favor, **consulte diretamente o consulado ou embaixada** do ${paisDestino} em seu pa√≠s de origem para detalhes espec√≠ficos, documentos e taxas. As regras variam muito!\n`;
                msg += `üîé Recomendamos buscar a representa√ß√£o diplom√°tica de ${paisDestino} no ${paisOrigem}.\n\n`;
            }

            // --- Custos de Servi√ßos Terceirizados ---
            const servicosTerceirizados = dadosPaises[paisOrigem]?.servicosComuns || dadosPaises[paisDestino]?.servicosComuns;
            if (servicosTerceirizados) {
                msg += `--- Custos Adicionais Estimados (Terceiros) ---\n`;
                msg += `‚öñÔ∏è **Tradu√ß√£o Juramentada:** ${servicosTerceirizados.traducaoJuramentada || 'Consultar tradutor juramentado'}\n`;
                msg += `üìú **Apostilamento (Haia):** ${servicosTerceirizados.apostilamento || 'Consultar cart√≥rio ou √≥rg√£o competente'}\n`;
                msg += `üë®‚Äç‚öñÔ∏è **Assessoria Jur√≠dica/Advogado:** Recomendado para processos complexos (visto de trabalho, resid√™ncia, ref√∫gio). Custos variam de acordo com o profissional e complexidade do caso (Ex: R$ 5.000 - R$ 20.000+ no Brasil para processos de resid√™ncia, ou US$ 1.000 - US$ 10.000+ nos EUA).\n\n`;
            } else {
                 msg += `--- Custos Adicionais Estimados (Terceiros) ---\n`;
                 msg += `‚öñÔ∏è **Tradu√ß√£o Juramentada:** Custos variam bastante. Pesquise por tradutores juramentados em seu pa√≠s/idioma.\n`;
                 msg += `üìú **Apostilamento (Haia):** Necess√°rio para validar documentos no exterior. Consulte cart√≥rios ou √≥rg√£os competentes no pa√≠s emissor do documento.\n`;
                 msg += `üë®‚Äç‚öñÔ∏è **Assessoria Jur√≠dica/Advogado:** Altamente recomendado para processos complexos, como vistos de trabalho, resid√™ncia, ref√∫gio ou anistia. Os custos variam muito conforme o profissional e a complexidade do caso.\n\n`;
            }


            // --- Custo Total e Observa√ß√µes Finais ---
            const moedaFinal = dadosPaises[paisDestino]?.moeda || 'Moeda local';
            msg += `--- Resumo dos Custos (Estimativa) ---\n`;
            msg += `üí∏ **Custo total estimado (taxas oficiais):** ${moedaFinal} ${custoTotalEstimado.toFixed(2).replace('.', ',')}\n`;
            msg += `*(Este valor n√£o inclui passagens, seguro viagem, moradia, ou servi√ßos de terceiros como advogados/tradutores. √â uma estimativa das taxas governamentais principais.)*\n\n`;

            msg += `üìå **Observa√ß√µes Importantes:**\n`;
            msg += `* Preferencialmente online (site oficial) ou presencial conforme consulado/√≥rg√£o.\n`;
            msg += `* As informa√ß√µes podem mudar. Sempre consulte os **links oficiais** fornecidos.\n`;
            msg += `* **Este assistente n√£o substitui uma consulta com um advogado de imigra√ß√£o.** Ele fornece um roteiro inicial, mas cada caso √© √∫nico e pode exigir an√°lise e acompanhamento profissional para garantir seguran√ßa e sucesso no processo.\n\n`;
            msg += `üöÄ Com apoio humano, h√° chances mais r√°pidas e seguras para seu processo.`;

            textoResultado.innerText = msg;
            resultadoContainer.classList.remove('hidden');
            resultadoContainer.scrollIntoView({ behavior: 'smooth' });
        }

        // --- Event Listeners para acionar montarResultado ---
        paisOrigemSelect.addEventListener('change', montarResultado);
        paisDestinoSelect.addEventListener('change', montarResultado);
        opcoesDiv.addEventListener('click', selecionarTipo); 

        // Event Listeners para o chat Gemini (ADICIONADOS AQUI)
        chatSendBtn.addEventListener('click', sendChatMessage);
        chatInput.addEventListener('keypress', (event) => {
            if (event.key === 'Enter') {
                sendChatMessage();
            }
        });

        // Inicializa o estado dos bot√µes ao carregar a p√°gina
        document.addEventListener('DOMContentLoaded', () => {
            document.querySelectorAll('#opcoes button').forEach(btn => {
                btn.classList.remove('selected');
            });
        });
    </script>
</body>
</html>
